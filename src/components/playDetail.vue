<template>
    <div id="playdetail">
      <div id="playdtBg" :style="{backgroundImage:'url('+song.al.picUrl+')',backgroundSize:'180%'}"></div>
      <div id="playdtCont">
        <!--歌曲信息-->
        <div id="playdtHead" class="playHead uk-grid uk-width-1-1 uk-padding-small uk-margin-remove">
          <div @click="$router.back(-1)" class="uk-width-1-6 uk-padding-remove">
            <svg class="icon" width="20px" height="20.00px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
              <path fill="#ffffff" d="M710.153924 8.980397L266.007127 460.692524a81.118646 81.118646 0 0 0 0.861532 114.476097l446.192936 441.050666a26.922883 26.922883 0 0 0 37.853573-38.284339L304.722232 536.884282a27.27288 27.27288 0 0 1-0.323074-38.445877L748.545955 46.726278A26.922883 26.922883 0 1 0 710.180847 9.00732z" />
            </svg>
          </div>
          <div class="uk-width-2-3 uk-padding-remove">
            <p class="uk-margin-remove uk-text-truncate">{{song.name}}</p>
            <p class="uk-margin-remove uk-text-small uk-text-truncate">{{song.ar[0].name}}</p>
          </div>
          <div @click="share" class="uk-width-1-6 uk-padding-remove uk-text-center">
            <svg class="icon" width="20px" height="20.00px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
              <path fill="#ffffff" d="M972.8 549.9136v294.7584A128.0768 128.0768 0 0 1 844.8 972.8H179.2a128 128 0 0 1-128-128V179.2c0-70.7328 57.1904-128 127.872-128h202.3168a25.6 25.6 0 0 0 0-51.2H179.072A179.072 179.072 0 0 0 0 179.2v665.6a179.2 179.2 0 0 0 179.2 179.2h665.6c98.944 0 179.2-80.2816 179.2-179.328V549.9136a25.6 25.6 0 0 0-51.2 0zM960 128c-353.4592 0-640 286.5408-640 640a25.6 25.6 0 0 0 51.2 0c0-325.1968 263.6032-588.8 588.8-588.8a25.6 25.6 0 0 0 0-51.2zM720.1024 62.1568l256 102.4a25.6 25.6 0 0 0 18.9952-47.5136l-256-102.4a25.6 25.6 0 0 0-18.9952 47.5136zM808.8064 348.4672l194.6368-189.312a25.6 25.6 0 1 0-35.6864-36.7104L773.12 311.7568a25.6 25.6 0 1 0 35.6864 36.7104z" />
            </svg>
          </div>
        </div>
        <!--歌曲封面-->
        <div id="playdtImg">
          <img v-lazy="song.al.picUrl" :key="song.al.picUrl">
        </div>
        <!--歌曲操作-->
        <div id="playAction" class="uk-position-bottom">
          <div class="uk-width-1-1 uk-grid uk-margin-remove uk-text-small uk-text-center">
            <div class="uk-width-1-6 uk-padding-remove">{{nowTime1}}</div>
            <progress class="uk-width-2-3 uk-padding-remove" :value="nowTime" :max="totalTime"></progress>
            <div class="uk-width-1-6 uk-padding-remove">{{totalTime1}}</div>
          </div>
          <div class="uk-grid uk-width-1-1 uk-margin-remove uk-padding-small uk-text-center">
            <div @click="changeMode" class="uk-width-1-5 uk-padding-small">
              <svg ref="mode" class="icon" width="20px" height="20.00px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
                <path fill="#ffffff" d="M1015.716072 239.637393c-11.261945 11.261945-29.178675 11.261945-40.44062 0l-139.750495-137.70287V767.92498h-1.023813c4.607159 76.785987-47.095405 163.298198-137.190963 215.000762-115.690886 66.547855-249.81041 50.678751-299.977254-36.345367-50.166845-86.512212 3.071439-210.90551 118.762326-277.965271 93.166997-53.750191 198.107845-53.750191 261.58426-6.654785V45.112893c0-15.869104-2.047626-29.690581 6.142879-36.857273 11.773851-10.750038 29.178675-11.261945 40.44062 0l190.941153 190.941153c11.261945 11.261945 11.261945 29.178675 0.511907 40.44062zM593.905052 182.303856H25.688752c-14.333384 0-25.595329-11.261945-25.595329-25.595329s11.261945-25.595329 25.595329-25.595329h568.2163c14.333384 0 25.595329 11.261945 25.595329 25.595329s-11.261945 25.595329-25.595329 25.595329zM442.892612 537.055114H25.688752c-14.333384 0-25.595329-11.261945-25.595329-25.595329s11.261945-25.595329 25.595329-25.595329h417.20386c14.333384 0 25.595329 11.261945 25.595329 25.595329 0 13.821478-11.261945 25.595329-25.595329 25.595329zM276.522975 891.294465H25.688752c-14.333384 0-25.595329-11.261945-25.595329-25.595329s11.261945-25.595329 25.595329-25.595329h250.834223c14.333384 0 25.595329 11.261945 25.595328 25.595329s-11.261945 25.595329-25.595328 25.595329z" />
              </svg>
            </div>
            <div @click="prev" class="uk-width-1-5 uk-padding-small">
              <svg class="icon" width="50px" height="50.00px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
                <path fill="#ffffff" d="M128 102.4V928c0 17.673 14.327 32 32 32 17.673 0 32-14.327 32-32V102.4c0-17.673-14.327-32-32-32-17.673 0-32 14.327-32 32zM774.028 143.795l-404.352 331.09c-27.383 22.42-27.435 58.886 0 81.35l404.352 331.09c27.382 22.42 49.676 12.003 49.676-23.366V167.16c0-35.646-22.24-45.83-49.676-23.365z m-40.546-49.518c69.12-56.597 154.222-16.897 154.222 72.883v696.8c0 89.481-85.14 129.447-154.222 72.883L329.13 605.753c-58.7-48.064-58.662-132.353 0-180.386l404.352-331.09z"  />
              </svg>
            </div>
            <div @click="playSong" class="uk-width-1-5 uk-padding-small">
              <svg ref="play" class="icon" width="50px" height="50.00px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
                <path fill="#ffffff" d="M512 1024C228.266667 1024 0 795.733333 0 512S228.266667 0 512 0s512 228.266667 512 512-228.266667 512-512 512z m0-42.666667c260.266667 0 469.333333-209.066667 469.333333-469.333333S772.266667 42.666667 512 42.666667 42.666667 251.733333 42.666667 512s209.066667 469.333333 469.333333 469.333333z m-106.666667-682.666666c12.8 0 21.333333 8.533333 21.333334 21.333333v384c0 12.8-8.533333 21.333333-21.333334 21.333333s-21.333333-8.533333-21.333333-21.333333V320c0-12.8 8.533333-21.333333 21.333333-21.333333z m213.333334 0c12.8 0 21.333333 8.533333 21.333333 21.333333v384c0 12.8-8.533333 21.333333-21.333333 21.333333s-21.333333-8.533333-21.333334-21.333333V320c0-12.8 8.533333-21.333333 21.333334-21.333333z" />
              </svg>
            </div>
            <div @click="next" class="uk-width-1-5 uk-padding-small">
              <svg class="icon" width="50px" height="50.00px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
                <path fill="#ffffff" d="M889.6 921.6V96c0-17.673-14.327-32-32-32-17.673 0-32 14.327-32 32v825.6c0 17.673 14.327 32 32 32 17.673 0 32-14.327 32-32zM243.572 880.205l404.352-331.09c27.383-22.42 27.435-58.886 0-81.35l-404.352-331.09c-27.382-22.42-49.676-12.003-49.676 23.366V856.84c0 35.646 22.24 45.83 49.676 23.365z m40.546 49.518c-69.12 56.597-154.222 16.897-154.222-72.883v-696.8c0-89.481 85.14-129.447 154.222-72.883l404.352 331.09c58.7 48.064 58.662 132.353 0 180.386l-404.352 331.09z"  />
              </svg>
            </div>
            <div @click="loveSong" class="uk-width-1-5 uk-padding-small">
              <svg ref="love" width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                <path fill="none" stroke="#fff" stroke-width="1.03" d="M10,4 C10,4 8.1,2 5.74,2 C3.38,2 1,3.55 1,6.73 C1,8.84 2.67,10.44 2.67,10.44 L10,18 L17.33,10.44 C17.33,10.44 19,8.84 19,6.73 C19,3.55 16.62,2 14.26,2 C11.9,2 10,4 10,4 L10,4 Z" />
              </svg>
            </div>
          </div>
        </div>
      </div>
    </div>
</template>

<script>
import {mapMutations, mapGetters} from 'vuex'
// import ProgressBar from 'base/progress-bar'

/* ** whichSong为歌曲在歌单数组对应下标**/
/* ** 监听whichSong，++,--,获取数组长度打乱序号进行一系列播放操作**/
export default {
  name: 'playDetail',
  data () {
    return {
      nowTime1: '00:00',
      totalTime1: '00:00',
      playMode: 'list'
    }
  },
  // 数据初始化(组件首次创建的isPlay，totalTime)
  mounted () {
    this.totalTime1 = this.changeTime(this.totalTime)
    if (this.isPlay) {
      this.$refs.play.children[0].attributes.d.nodeValue = 'M512 1024C228.266667 1024 0 795.733333 0 512S228.266667 0 512 0s512 228.266667 512 512-228.266667 512-512 512z m0-42.666667c260.266667 0 469.333333-209.066667 469.333333-469.333333S772.266667 42.666667 512 42.666667 42.666667 251.733333 42.666667 512s209.066667 469.333333 469.333333 469.333333z m-106.666667-682.666666c12.8 0 21.333333 8.533333 21.333334 21.333333v384c0 12.8-8.533333 21.333333-21.333334 21.333333s-21.333333-8.533333-21.333333-21.333333V320c0-12.8 8.533333-21.333333 21.333333-21.333333z m213.333334 0c12.8 0 21.333333 8.533333 21.333333 21.333333v384c0 12.8-8.533333 21.333333-21.333333 21.333333s-21.333333-8.533333-21.333334-21.333333V320c0-12.8 8.533333-21.333333 21.333334-21.333333z'
    } else {
      this.$refs.play.children[0].attributes.d.nodeValue = 'M512 0C230.4 0 0 230.4 0 512s230.4 512 512 512 512-230.4 512-512S793.6 0 512 0z m0 981.333c-258.133 0-469.333-211.2-469.333-469.333S253.867 42.667 512 42.667 981.333 253.867 981.333 512 770.133 981.333 512 981.333zM672 441.6L501.333 328.533c-57.6-38.4-106.666-12.8-106.666 57.6v256c0 70.4 46.933 96 106.666 57.6L672 586.667C729.6 544 729.6 480 672 441.6z'
    }
  },
  methods: {
    // 时间转换
    changeTime (time) {
      let sec = time % 60
      if (sec < 10) { sec = '0' + sec }
      let min = parseInt(time / 60)
      if (min < 10) { min = '0' + min }
      let newTime = min + ':' + sec
      return newTime
    },
    // 分享
    share () {
      var a = confirm('这么好听的歌怎么可以分享，我不同意这门婚事！你真的要分享吗？')
      if (a === true) {
        var b = confirm('过分！给你个机会再回答一次？')
        if (b === true) {
          var c = confirm('真的很过分欸！我都有小情绪了你看不出来吗，出去出去！')
          if (c === true) {
            var d = confirm('怎么还在？')
            if (d === true) {
              var e = confirm('你不爱我了？')
              if (e === true) {
                alert('你不走，我走！')
              } else {
                alert('In fact, 还没完成')
              }
            } else {
              alert('In fact, 还没完成')
            }
          } else {
            alert('In fact, 还没完成')
          }
        } else {
          alert('In fact, 还没完成')
        }
      } else {
        alert('In fact, 还没完成')
      }
    },
    // 改变播放模式
    changeMode () {
      var md = this.playMode
      if (md === 'list') {
        this.$refs.mode.children[0].attributes.d.nodeValue = 'M63.839469 734.681662c0-7.621585 6.167466-13.790074 13.790074-13.790074l170.093956 0c20.010753 0 38.836517-8.29492 52.989865-22.461571l389.285121-389.802914c19.378349-19.365046 45.125757-29.006637 72.488964-29.006637l150.593833 0-72.987315-74.010621c-5.386684-5.386684-5.386684-15.136745 0-20.522406 5.387707-5.386684 14.113439-5.386684 19.500123 0l96.512101 96.526427c2.505054 2.491751 4.054339 5.952572 4.054339 9.776667s-1.549286 7.312546-4.054339 9.803273l-96.512101 96.567359c-2.693342 2.693342-6.221702 4.175089-9.749038 4.175089-3.52836 0-7.05672-1.090844-9.750061-3.784186-5.386684-5.386684-5.386684-13.601786 0-18.987447l72.987315-71.950705L762.486426 307.213917c-19.99745 0-38.823214 7.284917-52.989865 21.424962L320.211441 717.418486c-19.378349 19.364023-45.112454 31.05325-72.488964 31.05325L77.62852 748.471736C70.006935 748.471736 63.839469 742.30427 63.839469 734.681662zM77.62852 307.213917l165.379585 0c22.717398 0 44.950771 8.187473 61.029982 24.25338l108.578927 108.053971c2.693342 2.693342 6.221702 3.784186 9.749038 3.784186 3.52836 0 7.05672-1.480724 9.749038-4.160763 5.387707-5.399987 5.387707-14.193257 0-19.579941L323.538209 311.994804c-21.519106-21.505803-50.121538-32.373315-80.529081-32.373315L77.62852 279.621489c-7.621585 0-13.790074 6.181793-13.790074 13.803377C63.839469 301.033148 70.006935 307.213917 77.62852 307.213917zM840.092945 838.911538c2.693342 2.693342 6.221702 4.040013 9.750061 4.040013 3.527336 0 7.05672-1.346671 9.749038-4.040013l96.512101-96.526427c2.505054-2.477424 4.054339-5.951549 4.054339-9.749038 0-3.824095-1.549286-7.271614-4.054339-9.776667l-96.512101-96.500844c-5.386684-5.386684-14.112416-5.386684-19.500123 0-5.386684 5.387707-5.386684 15.136745 0 20.523429l72.987315 74.010621L767.200798 720.892611c-23.054065 0-44.721551-10.019191-61.029982-26.313296L597.590865 585.502038c-5.386684-5.386684-14.112416-5.655813-19.4991-0.270153-5.387707 5.386684-5.387707 13.978363 0 19.365046l108.577904 109.561301c21.506826 21.4925 50.109258 34.31248 80.529081 34.31248l145.880485 0-72.987315 71.964008C834.706261 825.822428 834.706261 833.524854 840.092945 838.911538z'
        this.playMode = 'random'
      } else if (md === 'random') {
        this.$refs.mode.children[0].attributes.d.nodeValue = 'M161.874249 287.916409c0-7.741311 6.263657-14.004969 14.004969-14.004969l628.938316 0c31.593556 0 57.30617 23.619954 57.30617 55.226812L862.123704 588.127841l74.127278-74.121138c5.471618-5.470595 14.33345-5.470595 19.804045 0 5.471618 5.470595 5.471618 14.33345 0 19.789719l-98.020454 98.041944c-2.530636 2.543939-6.03239 4.103458-9.915837 4.103458-3.883447 0-7.385201-1.558495-9.92914-4.103458l-98.007151-98.041944c-5.470595-5.456269-5.470595-14.319124 0-19.789719 5.471618-5.470595 14.33345-5.470595 19.805068 0l74.127278 74.121138L834.11479 329.138252c0-16.166191-13.143345-27.216875-29.296233-27.216875L175.880241 301.921377C168.13893 301.921377 161.874249 295.65772 161.874249 287.916409zM87.746972 505.800811l74.127278-74.128301 0 259.002892c0 31.592532 25.711592 59.412135 57.305147 59.412135l628.938316 0c7.741311 0 14.005992-6.263657 14.005992-14.004969s-6.263657-14.004969-14.005992-14.004969L219.18042 722.077599c-16.151865 0-29.29521-15.236006-29.29521-31.403221L189.88521 431.67251l74.128301 74.128301c2.735297 2.735297 6.317892 4.103458 9.901511 4.103458 3.582595 0 7.166213-1.36816 9.901511-4.103458 5.470595-5.470595 5.470595-14.33345 0-19.804045l-98.021477-98.021477c-2.530636-2.543939-6.031367-4.116761-9.915837-4.116761s-7.385201 1.572822-9.92914 4.116761l-98.007151 98.021477c-5.470595 5.470595-5.470595 14.33345 0 19.804045C73.413522 511.258103 82.276377 511.258103 87.746972 505.800811z'
        this.playMode = 'circle'
      } else {
        this.$refs.mode.children[0].attributes.d.nodeValue = 'M1015.716072 239.637393c-11.261945 11.261945-29.178675 11.261945-40.44062 0l-139.750495-137.70287V767.92498h-1.023813c4.607159 76.785987-47.095405 163.298198-137.190963 215.000762-115.690886 66.547855-249.81041 50.678751-299.977254-36.345367-50.166845-86.512212 3.071439-210.90551 118.762326-277.965271 93.166997-53.750191 198.107845-53.750191 261.58426-6.654785V45.112893c0-15.869104-2.047626-29.690581 6.142879-36.857273 11.773851-10.750038 29.178675-11.261945 40.44062 0l190.941153 190.941153c11.261945 11.261945 11.261945 29.178675 0.511907 40.44062zM593.905052 182.303856H25.688752c-14.333384 0-25.595329-11.261945-25.595329-25.595329s11.261945-25.595329 25.595329-25.595329h568.2163c14.333384 0 25.595329 11.261945 25.595329 25.595329s-11.261945 25.595329-25.595329 25.595329zM442.892612 537.055114H25.688752c-14.333384 0-25.595329-11.261945-25.595329-25.595329s11.261945-25.595329 25.595329-25.595329h417.20386c14.333384 0 25.595329 11.261945 25.595329 25.595329 0 13.821478-11.261945 25.595329-25.595329 25.595329zM276.522975 891.294465H25.688752c-14.333384 0-25.595329-11.261945-25.595329-25.595329s11.261945-25.595329 25.595329-25.595329h250.834223c14.333384 0 25.595329 11.261945 25.595328 25.595329s-11.261945 25.595329-25.595328 25.595329z'
        this.playMode = 'list'
      }
    },
    // 点击播放
    playSong (isPlay) {
      this.setisPlay(!this.isPlay)
    },
    // 上一首
    prev () {
      if (this.playMode === 'list' || this.playMode === 'circle') {
        let whs = this.whichSong - 1
        this.setwhichSong(whs)
      } else if (this.playMode === 'random') {
        let len = this.songList.length
        let whs = parseInt(len * Math.random())
        this.setwhichSong(whs)
      } else {
        this.setwhichSong(0)
      }
    },
    // 下一首
    next () {
      if (this.playMode === 'list' || this.playMode === 'circle') {
        let whs = this.whichSong + 1
        this.setwhichSong(whs)
      } else if (this.playMode === 'random') {
        let len = this.songList.length
        let whs = parseInt(len * Math.random())
        this.setwhichSong(whs)
      } else {
        this.setwhichSong(0)
      }
    },
    // 收藏
    loveSong () {
      let loveFlag = this.$refs.love.children[0].attributes.fill.value
      if (loveFlag === 'none') {
        this.$refs.love.children[0].attributes.stroke.value = '#ff3333'
        this.$refs.love.children[0].attributes.fill.value = '#ff3333'
      } else {
        this.$refs.love.children[0].attributes.stroke.value = '#fff'
        this.$refs.love.children[0].attributes.fill.value = 'none'
      }
    },
    ...mapMutations({setwhichSong: 'setwhichSong', setisPlay: 'setisPlay', setSong: 'setSong'})
  },
  watch: {
    // 刷新播放时长，播放结束后切换歌曲
    nowTime () {
      this.nowTime1 = this.changeTime(this.nowTime)
      // 播放结束后
      if (this.nowTime + 1 === this.totalTime && this.totalTime !== 0) {
        if (this.playMode === 'list') {
          let whs = this.whichSong + 1
          this.setwhichSong(whs)
          // console.log('over')
        } else if (this.playMode === 'random') {
          let len = this.songList.length
          let whs = parseInt(len * Math.random())
          this.setwhichSong(whs)
        } else {
        }
      }
    },
    totalTime () {
      this.totalTime1 = this.changeTime(this.totalTime)
    },
    // 切换歌曲
    whichSong () {
      let whichS = this.whichSong
      let len = this.songList.length
      if (whichS < 0) {
        whichS = len - 1
      } else if (whichS > len - 1) {
        whichS = 0
      } else {}
      var newSong = this.songList[whichS]
      this.setSong(newSong)
    },
    // 播放键监听播放状态
    isPlay () {
      // 播放暂停
      if (this.isPlay) {
        document.querySelector('audio').play()
        this.$refs.play.children[0].attributes.d.nodeValue = 'M512 1024C228.266667 1024 0 795.733333 0 512S228.266667 0 512 0s512 228.266667 512 512-228.266667 512-512 512z m0-42.666667c260.266667 0 469.333333-209.066667 469.333333-469.333333S772.266667 42.666667 512 42.666667 42.666667 251.733333 42.666667 512s209.066667 469.333333 469.333333 469.333333z m-106.666667-682.666666c12.8 0 21.333333 8.533333 21.333334 21.333333v384c0 12.8-8.533333 21.333333-21.333334 21.333333s-21.333333-8.533333-21.333333-21.333333V320c0-12.8 8.533333-21.333333 21.333333-21.333333z m213.333334 0c12.8 0 21.333333 8.533333 21.333333 21.333333v384c0 12.8-8.533333 21.333333-21.333333 21.333333s-21.333333-8.533333-21.333334-21.333333V320c0-12.8 8.533333-21.333333 21.333334-21.333333z'
      } else {
        document.querySelector('audio').pause()
        this.$refs.play.children[0].attributes.d.nodeValue = 'M512 0C230.4 0 0 230.4 0 512s230.4 512 512 512 512-230.4 512-512S793.6 0 512 0z m0 981.333c-258.133 0-469.333-211.2-469.333-469.333S253.867 42.667 512 42.667 981.333 253.867 981.333 512 770.133 981.333 512 981.333zM672 441.6L501.333 328.533c-57.6-38.4-106.666-12.8-106.666 57.6v256c0 70.4 46.933 96 106.666 57.6L672 586.667C729.6 544 729.6 480 672 441.6z'
      }
    },
    // 歌单列表改变
    songList () {
      console.log('Pd watch List change')
    }
  },
  computed: {
    ...mapGetters(['songList', 'whichSong', 'song', 'whichSong', 'isPlay', 'nowTime', 'totalTime'])
  }
}
</script>

<style scoped>
#playdetail{position:fixed;top:0;left:0;right:0;bottom:0;z-index:1500;color:white;}
#playdtBg{width:110vw;height:110vh;position:absolute;left:-5vw;top:-5vh;filter:blur(12px);}
#playdtCont{position:absolute;width:100vw;height:100vh;background-color: rgba(25,25,25,0.34);opacity:0.8;}
#playdtHead{padding-bottom:20px;}
#playdtImg{position:absolute;top:16vh;width:100vw;text-align: center;}
#playdtImg img{border-radius: 100%;transform: scale(0.8);max-height:500px;border:10px solid darkgrey;}
#playAction progress{ transform: scaleY(0.3);}
#playAction svg{transform: scale(1);}
</style>
